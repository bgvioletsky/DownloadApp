name: 下载软件并发布文件

on:
  workflow_dispatch:
env:
    TZ: Asia/Shanghai
jobs:
   test:
       name: Test
       runs-on: ubuntu-latest
       steps:
       - name: Checkout code
         uses: actions/checkout@v3

       - name: Set up Go
         uses: actions/setup-go@v4
         with:
           go-version: '>=1.20.0'
       - name: 安装依赖
         run: |
             git clone https://github.com/bgvioletsky/DownloadApp.git  bg
             echo "version=$(bash version.sh)" >> $GITHUB_ENV
             cd ./bg/xbs
             go mod tidy && make
             echo "下载文件">>kk.txt
       - name: commit
         run: |
             git config --local user.email "44770157@qq.com"
             git config --local user.name "bgcode"
             git pull
             git add version.txt
             git commit -m "update $(date +'%Y-%m-%d %H:%M:%S')"  
       - name:  Push changes
         uses:  ad-m/github-push-action@master
         with:  
          branch: main
          github_token: ${{ secrets.MY_GIT_TOKEN }}
       - name: 发布到release
         uses: softprops/action-gh-release@v1
         with:
           tag_name: ${{env.version}}
           body_path: ./bg/xbs/kk.txt
           files: ./bg/xbs/kk/*
    
